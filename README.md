## About relay_board
The relay_board plugin for [OSPi](http://dan-in-ca.github.io/OSPi/) allows you to use one or more relay boards to control sprinkler valves. Some features:
- Control up to 12 stations
- Inexpensive relay boards reduce the cost of building your sprinkler controller

## Installation
The easiest way to install the relay_board plugin is the Plugin Manager in versions of OSPi newer than 2.2.28. Connect to OSPi with your web browser then select the **Plugin** menu and select **Manage Plugins**, then select the **Brows More Plugins** button. Find relay_board in the list and check the box on the right and select the **Install** button.

To install the plugin manually, download it from the [OSPi Plugin Repository](https://github.com/Dan-in-CA/ospi_plugins) and copy the `relay_board.py` and manifest files into the OSPi/plugins directory, then copy the `relay_board.html` file to the OSPi/templates directory. 

## Plugin Settings
Use your web browser to connect to OSPi running on your Raspberry Pi. After logging in, select the **Plugins** menu then select **Relay Board**.

**Relay channels:** From the drop-down list select the total number of relay channels you have connected. Often this is just one relay board but you can use as many boards as you want up to 12 total channels. 

**Active:** Select **Low** if your relays are activated (switched on) by taking the input low (0 Volts). Select **High** if the Raspberry Pi should change it's output (input of the relay board) from low to high (3.3 Volts).

**IMPORTANT:** If **Active** is changed, **Relay channels** will be set to 1 to prevent all the relays being switched on, and possibly damaging the power supply. After verifying that the first relay is off, return to this page and set Relay channels to the correct number.

## Relay Boards
Many relay boards are capable of being driven by a Raspberry Pi to turn sprinkler valves on. They are commonly available with 1, 2, 4, 8 and 16 channels.

### Mechanical Relay Boards
Boards with mechanical relays are the least expensive option and work fine. Mechanical relays contain a switch that is pulled closed by an electromagnetic coil - the switch turns the sprinkler valve on or off, and the electromagnetic coil is activated by the Raspberry Pi.

**Requirements:**

**3.3 Volt Capable** - The relay board must have circuitry that amplifies the 3.3 Volt output from the Raspberry Pi into enough power to activate the relay coil. Few relay boards for sale state that they can be driven by 3.3 Volts. Many relay boards are advertised as having 5 Volt inputs or Arduino compatible (Arduinos have 5 Volt outputs) and most of the time these will work with the 3.3 Volt output of the Raspberry Pi.

**Power In** - Most boards have an power input (usually labeled Vcc) used to energize the coils and power the amplification and protection circuits. The relatively weak outputs of the Raspberry Pi can't provide enough power to activate the relay. make sure the relay board has a power input and ground connection.

**Load Rating** - The switch output of the relay must be capable of handling the electrical current, or load, of the sprinkler valve. A typical sprinkler valve will activate with 0.2 Amps of 24 Volt AC power, so the relay must be able to handle this load. To be safe I recommend relays that can switch at least 0.5 Amps. Most relay boards use 10 Amp relays.

**Protection** - Most boards also have optoisolated inputs to protect the fairly sensitive outputs of the Raspberry Pi from being blown out by power spikes and voltages higher than 3.3 Volts. While not required, optosiolator inputs are strongly encouraged - they usually don't add much to the cost of the board. Also the coils of the relays should have diodes across them to protect from voltage spikes generated by a coil when it de-energizes - almost all boards have protection diodes.

**Indicators (LEDs)** - Although not required, it's nice to have LED indicators on the board so you can see when a relay is activated.
  
**Examples:**

**[Keyes funduino relay board](http://www.dx.com/p/arduino-compatible-4-channel-relay-shield-module-144762)** - This 4 channel relay board meets all the requirements above. It is active high, meaning a relay is switched on when the Raspberry Pi output changes from 0 Volts to 3.3 Volts. I particularly like how the indicator LEDs are powered by external power (Vcc) and not the Raspberry Pi output signal like some boards. There is also an [8 channel version](http://www.dx.com/p/keyes-8-channel-relay-expansion-module-w-optocoupler-isolation-red-blue-209453). [Schematic](http://electronicapagina.com/)

**[SainSmart relay board](http://www.sainsmart.com/arduino/arduino-components/relays/4-channel-5v-relay-module-for-pic-arm-avr-dsp-arduino-msp430-ttl-logic.html)** - This 4 channel relay board meets most of the requirements above. It is active low, meaning a relay is switched on when the Raspberry Pi output changes from 3.3 Volts to 0 Volts. The indicator LEDs are powered by the Raspberry Pi output signal, which isn't ideal but it works. There is also an [8 channel version](http://www.sainsmart.com/arduino/arduino-components/relays/8-channel-dc-5v-relay-module-for-arduino-pic-arm-dsp-avr-msp430-ttl-logic.html). [Schematic](http://1.bp.blogspot.com/-IEFq8WDTNsU/UOrJ_zfS5bI/AAAAAAAAAlY/TlDCtwJq2yQ/s1600/sainrelay.PNG)

## Solid State Relay (SSR) Boards
Boards with SSRs can be used but they are more expensive. SSRs use only electronic components (like transistors) to switch the load so they have no mechanical switch which may wear out. SSRs are a good choice when switching frequently, like many times a day or hour. Mechanical relays will handle years of typical sprinkler switching, but if you'd like higher reliability, go with SSR boards. I haven't tried any SSR boards so have no examples.

## Wiring
There are two phases of wiring:
- Connect the relay board(s) to the Raspberry Pi
- Connect the relay board(s) to the sprinkler valves and power (usually 24 Volts AC)

The diagram below show how to connect two relay boards (first an 8 channel board, then a 4 channel board) to the Raspberry Pi to control up to 12 sprinkler valves.

![Relay Board Wiring Diagram](https://dl.dropboxusercontent.com/u/9526908/relay_board/RelayWiringDiagram.png)

## Tips
- If the Pi is connected to a relay board and the relay_board plugin is disabled, the software restarted, and a station is set to on, three relays will be turned on and stay on.
- LEDs on some relay boards (SainSmart) degrade and prevent relay from activating (Fix is to either replace the LED or solder a wire jumper over it)
